<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="Hi~我是阿金,也可以叫我Arkin,做开发的阿金同学">
  <meta name="baidu-site-verification" content="KAIz07eWp9" />
  <meta name="baidu_union_verify" content="89761f418e2e32d488f0c783a8616865">
  <meta name="keyword" content="阿金,开发,前端,后端,产品,架构师">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      PHP的设计模式 | Hi,阿金
    
  </title>
  <link href="//cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.staticfile.org/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script src="//cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.staticfile.org/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="/js/qrious.js"></script>
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.staticfile.org/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.svg" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Hi,阿金 <span class="jumping-dots"><i>.</i><i>.</i><i>.</i></span></span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/categories/" class="item-link">分类</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">标签</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">归档</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">whois</a>
          
        </li>
      
    </ul>

    
  <!-- div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" autocomplete="off" name="q" results="0" placeholder="search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div -->


    
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">首页</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/categories/" class="menu-link">分类</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">标签</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">归档</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">whois</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>PHP的设计模式</h2>
  <div class="post-date">
    发表:<span> 2019-04-14 </span>
    分类:
      <span class="article-category">
        <a class="article-category-link" href="/categories/PHP/">PHP</a>
      </span>
    
  </div>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><p>设计模式是开发人员在面向对象编程实践在总结的经验和方案.<br>PHP中常用到的11种设计模式</p>
<ol>
<li>工厂模式</li>
<li>单例模式</li>
<li>注册模式</li>
<li>适配器模式</li>
<li>策略模式</li>
<li>数据对象映射模式</li>
<li>观察者模式</li>
<li>原型模式</li>
<li>装饰器模式</li>
<li>迭代器模式</li>
<li>代理模式</li>
</ol>
<p>设计模式参考 :<a href="https://github.com/doymyfmnikl/DesignPatternsPHP" target="_blank" rel="noopener">Php设计模式</a></p>
<h1 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h1><h2 id="1-单一职责-原则"><a href="#1-单一职责-原则" class="headerlink" title="1.单一职责 原则"></a>1.单一职责 原则</h2><p>一个类,只专心做好一件事情</p>
<h2 id="2-开-闭-原则-OCP"><a href="#2-开-闭-原则-OCP" class="headerlink" title="2.开/闭 原则(OCP)"></a>2.开/闭 原则(OCP)</h2><p>对扩展开放,对修改关闭.使程序易于升级与维护,对程序扩展时尽量不去修改原有代码.</p>
<h2 id="3-里氏代换-原则-LSP"><a href="#3-里氏代换-原则-LSP" class="headerlink" title="3.里氏代换 原则(LSP)"></a>3.里氏代换 原则(LSP)</h2><p>任何基类可以出现的地方,子类一定可以出现.但不能相反.</p>
<h2 id="4-依赖倒转-原则"><a href="#4-依赖倒转-原则" class="headerlink" title="4.依赖倒转 原则"></a>4.依赖倒转 原则</h2><p>开闭原则的基础,针对接口编程,依赖抽象而不依赖具体.</p>
<h2 id="5-接口隔离-原则-ISP"><a href="#5-接口隔离-原则-ISP" class="headerlink" title="5.接口隔离 原则(ISP)"></a>5.接口隔离 原则(ISP)</h2><p>降低类之间的耦合度,最小单一职责接口,不使用不需要的接口.(这里的接口指抽象类,抽象层)</p>
<h2 id="6-迪米特-法则-LOD"><a href="#6-迪米特-法则-LOD" class="headerlink" title="6.迪米特 法则(LOD)"></a>6.迪米特 法则(LOD)</h2><p>最小知道原则,<br>被依赖者:只暴露应该暴露的方法,<br>依赖者:只依赖应该依赖的对象</p>
<h2 id="7-配置化"><a href="#7-配置化" class="headerlink" title="7. 配置化"></a>7. 配置化</h2><p>尽量使用配置化,而不是硬编码</p>
<h2 id="8-合成复用-原则"><a href="#8-合成复用-原则" class="headerlink" title="8.合成复用 原则"></a>8.合成复用 原则</h2><p>尽量使用合成/聚合方式,而不是使用继承.</p>
<h1 id="php设计模式的基础"><a href="#php设计模式的基础" class="headerlink" title="php设计模式的基础"></a>php设计模式的基础</h1><p>了解的设计模式的基础,先了解PHP的基础语法和面向对象的特性,以及每个PHP版本的更新变化.<br>面向对象的高级特性.</p>
<h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><p>php5.3以后新增了命名空间. 命名空间允许同名的类名,避免命名冲突.<br>命名空间和文件系统中的目录结构原理类似.<br>可以于类,函数,常量一起使用.方便软件工程管理.</p>
<p>参考: <a href="https://www.php.net/manual/zh/language.namespaces.php" target="_blank" rel="noopener">php手册-命名空间</a></p>
<h3 id="定义命名空间"><a href="#定义命名空间" class="headerlink" title="定义命名空间"></a>定义命名空间</h3><p>必须在php文件前申明,以”\”分割多个单词.<br>注意点:</p>
<ol>
<li>命名空间名字为变量名,如不能以数字或特殊字符开头;</li>
<li>不能使用保留字,如php,PHP,PHP\Classes </li>
<li>名称本身不能与其它命名重复冲突</li>
</ol>
<p>要符合PSR-4规范,命名空间要与文件目录和文件名一一关联,注意文件名大小写,从根目录往下层级一一对应.<br>参考: <a href="https://www.php-fig.org/psr/psr-4/" target="_blank" rel="noopener">psr-4自动加载规范&gt;&gt;</a></p>
<p>[app.php]<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//常量 5.3以后可以使用const 定义常量</span></span><br><span class="line">    <span class="keyword">const</span> Author=<span class="string">"arkin"</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">testClass</span></span>&#123;</span><br><span class="line">        <span class="keyword">const</span> NAME=<span class="string">"testClass"</span>;</span><br><span class="line">        <span class="comment">// 静态方法</span></span><br><span class="line">        <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"testClass.index"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>也可以在同一个文件中定义多个命名空间.<br>命名空间,之后的代码.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一种</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">Model1</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">AModel</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">Model2</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BModel</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 第二种,使用大括号,这种语句命名空间&#123;&#125;之外不能有任何语句.除了declare.</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">Model1</span>&#123;</span><br><span class="line">        <span class="title">class</span> <span class="title">AModel</span> &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">namespace</span> <span class="title">Model2</span>&#123;</span><br><span class="line">        <span class="title">class</span> <span class="title">BModel</span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 全局命名空间</span><br><span class="line">    <span class="title">namespace</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h3 id="使用命名空间"><a href="#使用命名空间" class="headerlink" title="使用命名空间"></a>使用命名空间</h3><p>引用文件后,可以使用.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require</span> (<span class="string">'app.php'</span>);</span><br><span class="line">    <span class="comment">// 使用常量</span></span><br><span class="line">    <span class="keyword">echo</span> App\Author;</span><br><span class="line">    <span class="comment">// 使用函数</span></span><br><span class="line">    <span class="keyword">echo</span> App\index();</span><br><span class="line">    <span class="comment">// 使用类</span></span><br><span class="line">    $AClass= <span class="keyword">new</span> App\testClass();</span><br><span class="line">    <span class="comment">// 使用类的常量</span></span><br><span class="line">    <span class="keyword">echo</span> App\testClass::Name;</span><br><span class="line">    <span class="comment">// 调用类的静态方法</span></span><br><span class="line">    <span class="keyword">echo</span> App\testClass::index();</span><br><span class="line">    <span class="comment">// 全局 空间,包含系统自带类和函数</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">"有错误"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="use-别名"><a href="#use-别名" class="headerlink" title="use 别名"></a>use 别名</h3><p>除了以上通过全路径命名空间外,可use别名.<br>(&gt;PHP5.6)<br>如:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// 类别名,简写 use App\Controller;</span></span><br><span class="line">    <span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span> <span class="title">as</span> <span class="title">Controller</span>;</span><br><span class="line">    <span class="comment">// 函数别名</span></span><br><span class="line">    <span class="keyword">use</span> <span class="title">function</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">out</span> <span class="title">as</span> <span class="title">msg</span>;</span><br><span class="line">    <span class="comment">// 常量别名</span></span><br><span class="line">    <span class="keyword">use</span> <span class="title">const</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">Module</span> <span class="title">as</span> <span class="title">MdName</span>;</span><br><span class="line">    <span class="comment">// 多个连写</span></span><br><span class="line">    <span class="keyword">use</span> <span class="title">App</span>\<span class="title">Model</span>\<span class="title">A</span>,<span class="title">App</span>\<span class="title">Model</span>\<span class="title">B</span>;</span><br><span class="line">    <span class="comment">// 子命名空间</span></span><br><span class="line">    <span class="keyword">use</span> <span class="title">App</span>\<span class="title">Model</span>\&#123;</span><br><span class="line">        <span class="title">User</span>,</span><br><span class="line">        <span class="title">function</span> <span class="title">bindsql</span>,</span><br><span class="line">        <span class="title">const</span> <span class="title">Version</span> <span class="title">as</span> <span class="title">MySQLVer</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>参考: <a href="https://www.php.net/manual/zh/functions.anonymous.php" target="_blank" rel="noopener">php手册-匿名函数</a><br>在php5.3后引用.<br>又叫闭包函数(closures),其它语言使用lambda关键字.经常用于回调函数.临时创建的一个没名称的函数.和普通函数一样.<br>PHP匿名函数通过Closure类来实现.</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1</span></span><br><span class="line">$fun=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">var_dump($fun);<span class="comment">// 返回object(Closure)#2 (0) </span></span><br><span class="line">$fun();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例2</span></span><br><span class="line">array_map(<span class="function"><span class="keyword">function</span> <span class="params">($v1,$v2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> $v2.<span class="string">'-'</span>.$v1.PHP_EOL;</span><br><span class="line">&#125;,[<span class="number">1</span>,<span class="number">2</span>],[<span class="string">'a'</span>,<span class="string">'b'</span>]);</span><br></pre></td></tr></table></figure>
<h3 id="匿名函数-变量传递"><a href="#匿名函数-变量传递" class="headerlink" title="匿名函数 变量传递"></a>匿名函数 变量传递</h3><p>通过use来传递变量.变量类型.支持所有变量类型.<br>注:在PHP7.1以后,不允许传递\$this和内置的超全局变量(如\$_GET,\$_COOKIE),在匿名函数中可以获取到.<br>也不能与参数名重复.<br>例子:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$userName=<span class="string">"arkin"</span>;</span><br><span class="line">$local=<span class="string">"北京"</span>;</span><br><span class="line"><span class="comment">// 这里使用的强类型,use ()传递变量.</span></span><br><span class="line">$show=<span class="function"><span class="keyword">function</span> <span class="params">(string $msg)</span> <span class="title">use</span><span class="params">($userName,&amp;$local)</span> :<span class="title">string</span></span>&#123;</span><br><span class="line">    $local=<span class="string">"上海"</span>;</span><br><span class="line">    <span class="keyword">return</span> $userName.<span class="string">':'</span>.$msg;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $show(<span class="string">'走你!'</span>);<span class="comment">// 输出,'arkin:走你'</span></span><br><span class="line"><span class="keyword">echo</span> $local;<span class="comment">// 输出: 上海</span></span><br></pre></td></tr></table></figure></p>
<h3 id="绑定对象"><a href="#绑定对象" class="headerlink" title="绑定对象"></a>绑定对象</h3><p>可以绑定新的对象到匿名函数.其实就Closure对象.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此时$this为空</span></span><br><span class="line">$func=<span class="function"><span class="keyword">function</span> <span class="params">()</span></span>&#123;</span><br><span class="line">  var_dump(<span class="keyword">$this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 把新的对象 stdClass绑定到 匿名函数</span></span><br><span class="line">$fun2=$func-&gt;bindTo(<span class="keyword">new</span> stdClass());</span><br><span class="line"><span class="comment">// 此时的$this 为 stdClass()</span></span><br><span class="line">$fun2();</span><br></pre></td></tr></table></figure></p>
<p>匿名函数在php5.3以后会自动绑定$this,除非申明函数为静态匿名函数.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        $fun=<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">          var_dump(<span class="keyword">$this</span>);<span class="comment">// 正常</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 静态匿名函数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span>&#123;</span><br><span class="line">            var_dump(<span class="keyword">$this</span>);<span class="comment">// 报错</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><p>内核自带很多地方需要用到回调函数.<br>回调函数定义的6种方法.不同的函数可能实现不一样,大部分通用.<br>下面以array_map()为例;创建回调函数的方法.</p>
<h4 id="1-普通函数"><a href="#1-普通函数" class="headerlink" title="1. 普通函数"></a>1. 普通函数</h4><p>回调函数字符串的函数名称.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callback</span><span class="params">($v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> $v;</span><br><span class="line">    &#125;</span><br><span class="line">    array_map(<span class="string">'callback'</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-匿名函数"><a href="#2-匿名函数" class="headerlink" title="2. 匿名函数"></a>2. 匿名函数</h4><p>使用匿名函数,最常用的方法.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    array_map(<span class="function"><span class="keyword">function</span><span class="params">($v)</span></span>&#123;<span class="keyword">echo</span> $v;&#125;,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="3-类的方法"><a href="#3-类的方法" class="headerlink" title="3. 类的方法"></a>3. 类的方法</h4><p>支持两种字符类名+方法名与数组类名+方法名;<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">callback</span><span class="params">($v)</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第1种, 静态类字符串</span></span><br><span class="line">array_map(<span class="string">'MyClass::callback'</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="comment">// 第2种, 静态类数组</span></span><br><span class="line">array_map([<span class="string">'MyClass'</span>,<span class="string">'callback'</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="comment">// 第3种, 实例对象方法</span></span><br><span class="line">array_map([<span class="keyword">new</span> MyClass(),<span class="string">'callback'</span>],[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br></pre></td></tr></table></figure></p>
<h4 id="4-命名空间"><a href="#4-命名空间" class="headerlink" title="4. 命名空间"></a>4. 命名空间</h4><p>和静态方法类似.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">My</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">callback</span><span class="params">($v)</span></span>&#123;&#125;;</span><br><span class="line">array_map(<span class="string">'My\callback'</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br></pre></td></tr></table></figure></p>
<h4 id="5-函数生成器"><a href="#5-函数生成器" class="headerlink" title="5. 函数生成器"></a>5. 函数生成器</h4><p>使用create_function 函数生成器,有时在代码生成器时需要到.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array_map(create_function(<span class="string">'$v'</span>,<span class="string">'echo $v;'</span>),[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br></pre></td></tr></table></figure></p>
<h4 id="6-内置函数"><a href="#6-内置函数" class="headerlink" title="6. 内置函数"></a>6. 内置函数</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$arr=array_map(<span class="string">'htmlentities'</span>,[<span class="string">'&lt;a&gt;'</span>,<span class="string">'&lt;script&gt;'</span>,<span class="string">'xxxp'</span>]);</span><br></pre></td></tr></table></figure>
<h2 id="匿名类"><a href="#匿名类" class="headerlink" title="匿名类"></a>匿名类</h2><p>php7.0开始支持匿名类,anonymous class;</p>
<h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>和普通类一样定义,也可以继承 ,使用接口<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$class=<span class="keyword">new</span> <span class="class"><span class="keyword">class</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">"haha"</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">lala</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">$class-&gt;lala();</span><br></pre></td></tr></table></figure></p>
<h3 id="stdClass对象"><a href="#stdClass对象" class="headerlink" title="stdClass对象"></a>stdClass对象</h3><p>stdClass是一个特殊的基类,不需要定义就可以使用.但是stdClass没有方法,只能使用属性.<br>由于php没有定义空对象的方法,一般使用stdClass来创建一个空对象.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$obj= <span class="keyword">new</span> stdClass();</span><br><span class="line">$obj-&gt;name=<span class="string">"你主宗"</span>;</span><br><span class="line"><span class="keyword">echo</span> json_encode($obj);<span class="comment">// &#123;name:"你主宗"&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在JS中可以简单</span></span><br><span class="line"><span class="keyword">var</span> obj=&#123;<span class="string">"name"</span>:<span class="string">"你大爷"</span>&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="类的自动加载"><a href="#类的自动加载" class="headerlink" title="类的自动加载"></a>类的自动加载</h2><p>php使用require或include手动引用,在php5.2以后提供php自动引用功能.<br>自动引用类机制是,当发现未加载的类时会自动执行载入函数.</p>
<h3 id="autoload"><a href="#autoload" class="headerlink" title="__autoload()"></a>__autoload()</h3><p>__authload()函数只可以定义一次.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    Test1::index();</span><br><span class="line">    Test2::index();</span><br><span class="line">    <span class="comment">//$class 为 类名,包含命名空间</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__autoload</span><span class="params">($class)</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"自动载入类:"</span>,$class;</span><br><span class="line">        <span class="keyword">require</span> <span class="keyword">__DIR__</span>.DIRECTORY_SEPARATOR.$class.<span class="string">".php"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="spl-autoload-register"><a href="#spl-autoload-register" class="headerlink" title="spl_autoload_register()"></a>spl_autoload_register()</h3><p>spl是PHP的标准库的一类.<br>参考 : </p>
<ol>
<li><a href="https://www.php.net/manual/zh/intro.spl.php" target="_blank" rel="noopener">spl标准库</a></li>
<li><a href="https://www.php.net/manual/zh/function.spl-autoload-register.php" target="_blank" rel="noopener">spl_autoload_register</a></li>
</ol>
<p>spl_autoload_register好处:</p>
<ol>
<li>可以定义多个autoload函数</li>
<li>支持异常处理</li>
<li>可以注销已注册的函数</li>
</ol>
<p>示例简单自动加载,使用了命名空间.<br>目录结构如下:<br><img src="http://img.hi-arkin.com/2019-04-15-15553113345104.jpg" alt></p>
<p>Loader.php,作为统一加载类<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Bootstrap</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Loader</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $classMap=[];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 注册加载函数</span></span><br><span class="line">        spl_autoload_register([<span class="keyword">$this</span>,<span class="string">'register'</span>],<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        spl_autoload_unregister([<span class="keyword">$this</span>,<span class="string">'register'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 加载函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">($class)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 目录分隔符 windows为 '\',linux为 '/'</span></span><br><span class="line">        $sep=DIRECTORY_SEPARATOR;</span><br><span class="line">        $file=__ROOT.$sep.str_replace(<span class="string">'\\'</span>,$sep,$class).<span class="string">'.php'</span>;</span><br><span class="line">        <span class="keyword">if</span>(file_exists($file))&#123;</span><br><span class="line">            $loaded=<span class="keyword">include</span>($file);</span><br><span class="line">            <span class="keyword">if</span>($loaded)&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;classMap[$class]=$file;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getClassMap</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;classMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>index.php,入口文件引用<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根目录</span></span><br><span class="line"><span class="keyword">const</span> __ROOT=<span class="keyword">__DIR__</span>;</span><br><span class="line"><span class="keyword">require_once</span> __ROOT.<span class="string">'/Bootstrap/Loader.php'</span>;</span><br><span class="line">$autoload=<span class="keyword">new</span> \Bootstrap\Loader();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用类</span></span><br><span class="line">(<span class="keyword">new</span> App\Controller\Home())-&gt;index();</span><br><span class="line"></span><br><span class="line">var_dump($autoload-&gt;getClassMap());</span><br></pre></td></tr></table></figure></p>
<h2 id="PHP标准库-SPL"><a href="#PHP标准库-SPL" class="headerlink" title="PHP标准库(SPL)"></a>PHP标准库(SPL)</h2><p>参考 : <a href="https://www.php.net/manual/zh/book.spl.php" target="_blank" rel="noopener">SPL文档</a><br>常用到的是:SPL函数,数据结构和迭代器</p>
<h2 id="PHP常用的数据结构"><a href="#PHP常用的数据结构" class="headerlink" title="PHP常用的数据结构"></a>PHP常用的数据结构</h2><p>PHP常见的数据结构,数组,队列,堆,栈</p>
<h3 id="1-数组"><a href="#1-数组" class="headerlink" title="1.数组"></a>1.数组</h3><p>数组: 连续方式存储数据的结构,可以通过索引访问.注意不是指PHP的数组.<br>特点: 固定长度,索引只能为数字,性能快<br>使用SplFixedArray类<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$arr= <span class="keyword">new</span> SplFixedArray(<span class="number">3</span>);<span class="comment">//0,1,2</span></span><br><span class="line">$arr[<span class="number">2</span>]=<span class="string">"abc"</span>;</span><br><span class="line">$arr[<span class="number">3</span>]=<span class="string">"ccdd"</span>;<span class="comment">// 这里会报错,超时索引最大值</span></span><br><span class="line">$arr-&gt;getSize(<span class="number">4</span>);<span class="comment">// 可以修改数组长度</span></span><br></pre></td></tr></table></figure></p>
<p>PHP内置数组底层使用的是HashTable实现.</p>
<h3 id="2-队列"><a href="#2-队列" class="headerlink" title="2.队列"></a>2.队列</h3><p>一种特殊的线性表,特性是先进先出.<br>主要支持:入队(enqueue),出队(dequeue)<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$que = <span class="keyword">new</span> SplQueue();</span><br><span class="line">$que-&gt;enqueue(<span class="string">"1"</span>);</span><br><span class="line">$que-&gt;enqueue(<span class="string">"2"</span>);</span><br><span class="line"><span class="keyword">echo</span> $que-&gt;dequeue();<span class="comment">//1</span></span><br><span class="line"><span class="keyword">echo</span> $que-&gt;dequeue();<span class="comment">//2</span></span><br></pre></td></tr></table></figure></p>
<h3 id="3-栈"><a href="#3-栈" class="headerlink" title="3.栈"></a>3.栈</h3><p>特性: 先进后出<br>主要方法: 入栈(push)/出栈(pop)<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">que = <span class="keyword">new</span> SplStack();</span><br><span class="line">$que-&gt;push(<span class="string">"1"</span>);</span><br><span class="line">$que-&gt;push(<span class="string">"2"</span>);</span><br><span class="line"><span class="keyword">echo</span> $que-&gt;pop();<span class="comment">//2</span></span><br><span class="line"><span class="keyword">echo</span> $que-&gt;pop();<span class="comment">//1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-堆"><a href="#4-堆" class="headerlink" title="4.堆"></a>4.堆</h3><p>不会.</p>
<h2 id="序列化-反序列化"><a href="#序列化-反序列化" class="headerlink" title="序列化/反序列化"></a>序列化/反序列化</h2><p>序列化的目的,是将变量转成可存储和传输的字符串的过程.<br>PHP常用的序列化方式,</p>
<ol>
<li>json_encode/json_decode</li>
<li>serialize/unserialize</li>
</ol>
<h3 id="serialize-对象"><a href="#serialize-对象" class="headerlink" title="serialize 对象"></a>serialize 对象</h3><p>对象在序列化时会先尝试调用<strong>sleep(),unserialize时尝试调用</strong>wakeup();<br>serialize不可以序列化匿名类.<br>// 第一种,使用<strong>sleep和</strong>wakup<br>__sleep用来做返回属性名称的数组,不能返回父类属性.<br>注意:反序列化时,类必须存在</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myClass</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $name=<span class="string">"arkin"</span>;</span><br><span class="line">    <span class="keyword">protected</span> $sex=<span class="string">"1"</span>;</span><br><span class="line">    <span class="keyword">const</span> Local=<span class="string">"beijin"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name=<span class="string">"zhangesan"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sex=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">out</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;name,<span class="keyword">$this</span>-&gt;sex,<span class="keyword">self</span>::Local;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;out();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">'name'</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">$str=serialize(<span class="keyword">new</span> myClass());</span><br><span class="line"><span class="keyword">echo</span> $str,PHP_EOL;</span><br><span class="line"></span><br><span class="line">$obj=unserialize($str);</span><br><span class="line">$obj-&gt;name;</span><br></pre></td></tr></table></figure>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>在反序列化对象时,需要加载对应的类.<br>序列化,常用于缓存对象,异构系统之间传输对象.<br>常见的异步处理消息队列,在消息体中会存储依赖类的路径和序列化的数据;在消费时会加载依赖的类,在反序列化.<br>反顺序化时会调用自动加载类函数.__autoload或spl_autoload_register;</p>
<h2 id="PSR规范"><a href="#PSR规范" class="headerlink" title="PSR规范"></a>PSR规范</h2><p>无规矩没方圆, PHP规范是PHP软件工程的基础.</p>
<ol>
<li>PSR-0 和 PSR-4: 自动加载标准,命名规范,现在使用PSR-4代替. </li>
<li>PSR-1 和 PSR-2: 编码风格规范 </li>
<li>PSR-3 : 日志规范</li>
</ol>
<h3 id="PSR-0-PSR-4"><a href="#PSR-0-PSR-4" class="headerlink" title="PSR-0 ~ PSR-4"></a>PSR-0 ~ PSR-4</h3><p><a href="https://www.php-fig.org/psr/psr-4/" target="_blank" rel="noopener">psr-4</a></p>
<ol>
<li>全部使用命名空间,命名空间与目录结构一致;</li>
<li>所有PHP文件必须使用自动载入,不能有Include/require;</li>
<li>只有一个单一入口;</li>
<li>类名要与文件名一致,一个文件只有一个类,不能含有其他运行代码;</li>
</ol>
<p>大部分主流的PHP的框架都遵守PSR规范.<br>其它规范参考官方文档,与设计模式无关.</p>
<h2 id="PHP链式操作"><a href="#PHP链式操作" class="headerlink" title="PHP链式操作"></a>PHP链式操作</h2><p>在一些框架,如Laravel中经常使用链式操作.<br>实现原理:通过调用方法中 返加 \$this;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BaseModel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">where</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"条件"</span>,PHP_EOL;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">order</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"排序"</span>,PHP_EOL;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">find</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"查询"</span>,PHP_EOL;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> BaseModel())-&gt;where()-&gt;order()-&gt;find();</span><br></pre></td></tr></table></figure>
<h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><h3 id="get-set"><a href="#get-set" class="headerlink" title="get/set"></a><strong>get/</strong>set</h3><p><strong>对象属性不存在时</strong>;<br><strong>set: 当外部设置赋值一个不存在的属性时,会触</strong>set方法;该方法有两个参数:\$name:属性名称,\$value:属性值;<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($name, $value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$name=$value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj= <span class="keyword">new</span> MyClass();</span><br><span class="line">$obj-&gt;name=<span class="string">"haha"</span>;<span class="comment">// 不存在name属性</span></span><br></pre></td></tr></table></figure></p>
<p><strong>get: 当调用一个不存在的属性时,会触发 \</strong>get方法;<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $name.<span class="string">"不存在"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj= <span class="keyword">new</span> MyClass();</span><br><span class="line">$obj-&gt;name=<span class="string">"haha"</span>;<span class="comment">// 不存在name属性</span></span><br></pre></td></tr></table></figure></p>
<h3 id="call-callStatic"><a href="#call-callStatic" class="headerlink" title="call/callStatic"></a><strong>call/</strong>callStatic</h3><p><strong>对象和类方法不存在时</strong>.<br><strong>当调用不存在的方法</strong>时,会触发 <strong>call方法
</strong>call有两个参数: \$func:方法名,\$params:参数<br>返回: 当作不存在方法的返回值.</p>
<p>__callStatic: 为静态方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class MyClass&#123;</span><br><span class="line">    static __callStatic($func,$params)&#123;</span><br><span class="line">        return 123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString"></a>__toString</h3><p><strong>将对象转字符串</strong>.<br>在 echo 一个对象时.<br>可以使用 __toString(){ return “classsxx”;} 返回字符串.</p>
<h3 id="invoke"><a href="#invoke" class="headerlink" title="__invoke"></a>__invoke</h3><p><strong>将对象当成函数来执行</strong>;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"把对象当成函数来执行"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj= <span class="keyword">new</span> MyClass();</span><br><span class="line"><span class="keyword">echo</span> $obj();</span><br></pre></td></tr></table></figure>
<h2 id="浅拷贝与深拷贝"><a href="#浅拷贝与深拷贝" class="headerlink" title="浅拷贝与深拷贝"></a>浅拷贝与深拷贝</h2><p>这个在JS中也是一个注意点,拷贝本身是一个耗资源的过程.<br>为了利用内存空间,程序语言设计时都在拷贝做优化,在文件系统中快捷方式类似.<br>浅拷贝:指共享内存空间地址,起了个别名,修改一个很影响到另一个.<br>深拷贝:指把内存空间复制一份出来,另起存储,从拷贝的那一刻起,大家一刀两断,互不影响.</p>
<h3 id="普通变量"><a href="#普通变量" class="headerlink" title="普通变量"></a>普通变量</h3><p>“=”赋值为深拷贝,使用”=&amp;”赋值为浅拷贝.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$a=<span class="number">100</span>;</span><br><span class="line"><span class="comment">// 深拷贝</span></span><br><span class="line">$b=$a;</span><br><span class="line"><span class="comment">// 浅拷贝</span></span><br><span class="line">$c=&amp;$a;</span><br><span class="line">$a=<span class="number">200</span>;</span><br><span class="line">var_export([</span><br><span class="line">    <span class="string">'$a'</span>=&gt;$a,<span class="comment">//200</span></span><br><span class="line">    <span class="string">'$b'</span>=&gt;$b,<span class="comment">//100</span></span><br><span class="line">    <span class="string">'$c'</span>=&gt;$c,<span class="comment">//200</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">$c=<span class="number">300</span>;</span><br><span class="line">var_export([</span><br><span class="line">    <span class="string">'$a'</span>=&gt;$a,<span class="comment">//300</span></span><br><span class="line">    <span class="string">'$b'</span>=&gt;$b,<span class="comment">//还是100</span></span><br><span class="line">    <span class="string">'$c'</span>=&gt;$c,<span class="comment">//300</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<h3 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h3><p>普通”=”赋值为浅拷贝,使用”clone”为深拷贝<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$obj=<span class="keyword">new</span> stdClass();</span><br><span class="line">$obj-&gt;name=<span class="string">"阿金"</span>;</span><br><span class="line"><span class="comment">// 浅拷贝,相当于起了别名</span></span><br><span class="line">$boy=$obj;</span><br><span class="line"><span class="comment">// 深拷贝,clone了一模一样的我</span></span><br><span class="line">$girl=<span class="keyword">clone</span> $obj;</span><br><span class="line">$obj-&gt;name=<span class="string">"Arkin"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $obj-&gt;name.<span class="string">'--'</span>.$boy-&gt;name,PHP_EOL;<span class="comment">//Arkin - Arkin</span></span><br><span class="line">$boy-&gt;name=<span class="string">"Kim"</span>;</span><br><span class="line"><span class="keyword">echo</span> $obj-&gt;name.<span class="string">'--'</span>.$boy-&gt;name,PHP_EOL;<span class="comment">//Kim - Kim</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $obj-&gt;name.<span class="string">'--'</span>.$girl-&gt;name,PHP_EOL;<span class="comment">//Kim - Arkin</span></span><br><span class="line">$girl-&gt;name=<span class="string">"丽娜"</span>;</span><br><span class="line"><span class="keyword">echo</span> $obj-&gt;name.<span class="string">'--'</span>.$girl-&gt;name,PHP_EOL;<span class="comment">//Kim - 丽娜</span></span><br></pre></td></tr></table></figure></p>
<h3 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h3><p>与变量赋值一样,普通参数为深拷贝,带”&amp;”为浅拷贝<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ren=<span class="string">"红"</span>;</span><br><span class="line"><span class="comment">// 出淤泥不染</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lianhua</span><span class="params">($color)</span></span>&#123;</span><br><span class="line">    $color=<span class="string">"黑"</span>;</span><br><span class="line">    <span class="keyword">echo</span> $color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 变了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shehui</span><span class="params">(&amp;$color)</span></span>&#123;</span><br><span class="line">    $color=<span class="string">"黑"</span>;</span><br><span class="line">    <span class="keyword">echo</span> $color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lianhua($ren);</span><br><span class="line"><span class="keyword">echo</span> $ren,PHP_EOL;<span class="comment">// 保持本心,"红"</span></span><br><span class="line">shehui($ren);</span><br><span class="line"><span class="keyword">echo</span> $ren,PHP_EOL;<span class="comment">// 被传染,"黑"</span></span><br></pre></td></tr></table></figure></p>
<h1 id="PHP设计模式"><a href="#PHP设计模式" class="headerlink" title="PHP设计模式"></a>PHP设计模式</h1><p>常用的工厂模工,单例模式,注册机模式;</p>
<h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><p>使用统一的类或方法去new 对象,而不是手工new 对象;<br>优点:<br>单一创建对象入口;当项目中有很多地方需要new 一个对象时,假如对象的参数,或对象名变化,就需要批量修改 new 的代码.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class DataBase()&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($host,$database,$user,$password)</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $db=<span class="keyword">new</span> DataBase(<span class="string">"127.0.0.1"</span>,<span class="string">'test'</span>,<span class="string">'root'</span>,<span class="string">'123456'</span>);</span><br><span class="line">        <span class="keyword">return</span> $db;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$db1=Factory::createDatabase();</span><br><span class="line">$db2=Factory::createDatabase();</span><br><span class="line">$db3=Factory::createDatabase();</span><br></pre></td></tr></table></figure></p>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>避免资源浪费,减少连接数.如数据库连接,共用一个即可.<br>如上,已经new 过的对象,后面就不需要再次new了.<br>主要实现步骤:</p>
<ol>
<li>把 __construct 析构函数变成私有private.就不可以直接new 实例化.</li>
<li>申明一个获取实例的静态方法, 如getInstance()方法</li>
<li>申明一个私有的属性来存储实例.</li>
<li>当发现未实例化过,实例化 new self();,已实例化则直接返回该实例.</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class DataBase()&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> $db=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($host,$database,$user,$password)</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">($host,$database,$user,$password)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">self</span>::$db)&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">self</span>::$db; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>::$db= <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$db;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $db=DataBase::getInstance(<span class="string">"127.0.0.1"</span>,<span class="string">'test'</span>,<span class="string">'root'</span>,<span class="string">'123456'</span>);</span><br><span class="line">        <span class="comment">// 下面模式 Register,注册到db1</span></span><br><span class="line">        Register::set(<span class="string">'db1'</span>,$db);</span><br><span class="line">        <span class="keyword">return</span> $db;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$db1=Factory::createDatabase();</span><br><span class="line">$db2=Factory::createDatabase();</span><br></pre></td></tr></table></figure>
<h2 id="注册机模式"><a href="#注册机模式" class="headerlink" title="注册机模式"></a>注册机模式</h2><p>全局统一注册,其它地方获取而不是用实例化.<br>主要两个方法: set(‘别名’,’实例化对象’),remove(‘别名’),get(‘别名’);<br>统一set和remove,其它统一get.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 对象库</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span>  $objects=[];</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span>  <span class="title">set</span><span class="params">($alias,$object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">self</span>::$objects[$alias]=$object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span>  <span class="function"><span class="keyword">function</span> <span class="title">remove</span><span class="params">($alias)</span></span>&#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="keyword">self</span>::$objects[$alias]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($alias)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$objects[$alias];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><p>将截然不同的函数接口封装成统一的API<br>比如,数据库将mysql,mysqli,pdo封装成成统一操作接口,比如缓存:统一redis,memecache,mongodb</p>
<p>实现步骤:</p>
<ol>
<li>约定统一接口</li>
<li>分别创建实例,实现约定的方法</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 统一接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span>  <span class="title">IDatabase</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">($host,$user,$password,$dbName)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">($sql)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其它实现<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现接口</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysqli</span> <span class="keyword">implements</span> <span class="title">IDatabase</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $conn;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">($host,$user,$password,$dbName)</span></span>&#123;</span><br><span class="line">        $conn=mysqli_connect($host,$user,$password,$dbName);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;conn=$conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">($sql)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  mysqli_query(<span class="keyword">$this</span>-&gt;conn,$sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mysqli_close(<span class="keyword">$this</span>-&gt;conn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><p>将一组特定的行为和算法封装成类,以适应某些特定的上下文环境.</p>
<p>比如, 不同的用户角色类型,展示不同的广告.不同的角色使用不同的策略.如果很多页面,则需要很多次硬编码.<br>使用策略模式,可以减少工作量和解耦.</p>
<p>实现方式:</p>
<ol>
<li>定义接口类</li>
<li>每种策略实现一种接口</li>
<li>在调用的提供一个设置策略接口</li>
<li>全局统一策略,把策略传递给需要实现策略的地方</li>
</ol>
<p>广告策略类:<br>1定义接口<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UserStrategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showAd</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showCategory</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.实现多种策略接口<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Male</span> <span class="keyword">implements</span> <span class="title">UserStrategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showAd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"男装"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showCategory</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Female</span> <span class="keyword">implements</span> <span class="title">UserStrategy</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showAd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"女装"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">showCategory</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3页面<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $strategy;</span><br><span class="line">    <span class="comment">// 设置</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStrategy</span><span class="params">(\App\Strategy\UserStrategy $strategy)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;strategy=$strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">index</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"广告"</span>,<span class="keyword">$this</span>-&gt;strategy-&gt;show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>4入口,根据不同条件,传递不同接口实现<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'female'</span>]))&#123;</span><br><span class="line">    $strategy= <span class="keyword">new</span> \App\Strategy\Female();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $strategy= <span class="keyword">new</span> \App\Strategy\Male();</span><br><span class="line">&#125;</span><br><span class="line">$page-&gt;setStrategy($strategy);</span><br><span class="line">$page-&gt;index();</span><br></pre></td></tr></table></figure></p>
<h2 id="数据对象映射模式"><a href="#数据对象映射模式" class="headerlink" title="数据对象映射模式"></a>数据对象映射模式</h2><p>将对象和数据存储映射,对一个对象的操作会映射为对数据的操作;<br>场景: 比如Model的属性和表的字段映射起来.常用在ORM上.<br>简单实现方式:</p>
<ol>
<li>创建一个类,属性与数据库表字段一致.</li>
<li>construct时连接数据库表</li>
<li>destruct量把model的属性更新到数据表<br>示例</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $id;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $mobile;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db= <span class="keyword">new</span> \App\Database\Mysqli();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db-&gt;connect(<span class="string">'127.0.0.1'</span>,<span class="string">'root'</span>,<span class="string">'123456'</span>,<span class="string">'Test'</span>);</span><br><span class="line">        $res= <span class="keyword">$this</span>-&gt;db-&gt;query(<span class="string">"select * from users where id=$id"</span>);</span><br><span class="line"></span><br><span class="line">        $data=$res-&gt;fetch_assoc();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;id=$id;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name=$data[<span class="string">'name'</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mobile=$data[<span class="string">'mobile'</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $sql=<span class="string">"update users set name='&#123;$this-&gt;name&#125;',mobile='&#123;$this-&gt;mobile&#125;' where id=&#123;$this-&gt;id&#125;"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用X22  `</span></span><br><span class="line">$model=<span class="keyword">new</span> User(<span class="number">1</span>);</span><br><span class="line">$model-&gt;name=<span class="string">"小画"</span></span><br><span class="line">$model-&gt;<span class="number">13800013800</span>;</span><br></pre></td></tr></table></figure>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>当一个对象状态发生变化时,依赖它的对象全部收到通知,并自动更新.<br>场景: 一个事件发生后,要执行一连串更新操作.<br>传统方法是,直接在事件中加入处理逻辑,当需要加入或更新更多的处理逻辑时就需要修改事件主体本身.<br>观察者模式使用:通知 与 更新机制<br>即是: <strong>订阅</strong> –&gt; <strong>通知</strong> 模型<br>使用之前:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Events</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderEvent</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 触发器</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">trigger</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"事件"</span>,PHP_EOL;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"处理逻辑1"</span>,PHP_EOL;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"处理逻辑2"</span>,PHP_EOL;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"处理逻辑3"</span>,PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Events</span>;</span><br><span class="line">$event=<span class="keyword">new</span> Events\OrderEvent();</span><br><span class="line">$event-&gt;trigger();</span><br></pre></td></tr></table></figure>
<p>使用观察者:<br><img src="http://img.hi-arkin.com/2019-04-17-15555079852288.jpg" alt><br>分 事件部分 和 观察者部分.<br>事件部分:<br>1步:事件发生 抽象类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Events</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Observers</span>\<span class="title">Observer</span>;</span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">EventGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> array 观者者列表 */</span></span><br><span class="line">    <span class="keyword">private</span>  $observers=[];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加观察者</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Observer $observer  观察者对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addObserver</span><span class="params">(Observer $observer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;observers[]=$observer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 触发通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">notify</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;observers <span class="keyword">as</span> $observer)&#123;</span><br><span class="line">            $observer-&gt;update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2步,观察者接口</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Observers</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> null $event 事件信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($event=NULL)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>(PS,由于markdown编辑器代码太多,出现卡顿,下面使用图片代替代码)</p>
</blockquote>
<p>3步,实现具体事件<br><img src="http://img.hi-arkin.com/2019-04-17-15555092192886.jpg" alt></p>
<p>4步,创建观察者,一个或多个<br><img src="http://img.hi-arkin.com/2019-04-17-15555093244243.jpg" alt></p>
<p>5步,事件中,添加观察者<br><img src="http://img.hi-arkin.com/2019-04-17-15555094319223.jpg" alt><br>运行结果.<br><img src="http://img.hi-arkin.com/2019-04-17-15555095042252.jpg" alt></p>
<p>事件观察者和事件监听者一样.稍微区别.<br>事件观察: 被观察者 –&gt; 观察者(多个)<br>事件监听: 事件源(多个)–&gt; 事件 –&gt; 监听器(多个)<br>盗用图:<br><img src="http://img.hi-arkin.com/2019-04-17-15555097603633.jpg" alt></p>
<h2 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h2><p>与工厂模式类似,都是统一创建对象.<br>原型类是JS中的原型,先创建好一个原型对象,然后clone 原型对象来创建新的对象.<br>这样免去了类实例化操作,减少内存开销.<br>先理解对象的深拷贝和浅拷贝.</p>
<p>使用场景: 初始实例化类消耗大量资源时</p>
<p>步骤:1. 创建一个原型对象 2. clone 原型对象</p>
<h2 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h2><p>实际上,可以动态和修改 类的功能.<br>场景: 需要灵活动态添加和修改类的功能时.<br>也可以理解为中间件.钩子</p>
<p>如: 控制器 增加调用前和调用后两个装饰器,就可以动态添加改变内容了.<br>1步,绑定勾子,寻增加装饰函数,执行函数<br><img src="http://img.hi-arkin.com/2019-04-18-15555276106582.jpg" alt></p>
<p>2步,调用时可以动态添加装饰函数<br><img src="http://img.hi-arkin.com/2019-04-18-15555277305275.jpg" alt></p>
<p>除了装饰函数,也可以使用装饰类.<br>类似CI框架通过大量的勾子实现中间件的功能.<br>Laravel框架中间件.</p>
<p>注意点,勾子和中间件函数,都提供一个类似 next()方法,来传递是否进行.</p>
<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><p>在不需要了解内部的前提下,遍历一个聚合对象.<br>php 中已经有很多迭代器.其它可以简单理解为可以循环的对象.<br>通过实现 Iterator类.<br>主要实现5个方法:current返回当前数据,key返回当前索引,next下一个索引,rewind重置索引,valid验证数据<br>创建迭代器类.<br><img src="http://img.hi-arkin.com/2019-04-18-15555297186259.jpg" alt><br>然后就可以循环了.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$users= <span class="keyword">new</span> Users();</span><br><span class="line"><span class="keyword">foreach</span> ($users <span class="keyword">as</span> $key=&gt;$user)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $key,<span class="string">'=&gt;'</span>,$user,PHP_EOL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><p>和我们理解的代理一样,网络代理,代购,代理人等一样.<br>分为: 主题–&gt;代理人–&gt;实际对象</p>
<p>和适配器模式一样,但代理人实现一样的方法.<br>场景: 大数据对象,按需要加载,延迟加载,读写分离,权责分离,控制等</p>
<p>大数据场景:<br>一个大的对象,先实例化一个轻量的对象,当需要某部分数据才实例化.</p>
<p>读写分离:orm类读数据库从从库实例获取数据,写数据时写入到master实例.</p>
<h1 id="常用设计结构"><a href="#常用设计结构" class="headerlink" title="常用设计结构"></a>常用设计结构</h1><h2 id="MVC-结构"><a href="#MVC-结构" class="headerlink" title="MVC 结构"></a>MVC 结构</h2><p>mvc是一种常用的 C/S或B/S软件工程的组织方式.<br>M: 模型(Model),数据和存储的封装<br>V: 视图(View),展现层的封装<br>C: 控制器(Controller),逻辑层的封装</p>
</section>
    <!-- 版权开始 -->
    <div class="post-copyright">
      <p><strong>本文作者：</strong>阿金 </p>
      <p><strong>本文链接：</strong><a href="http://www.hi-arkin.com/2019/04/14/PHP/design_parttern/">http://www.hi-arkin.com/2019/04/14/PHP/design_parttern/</a></p>
      <p><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 
      <a target="__blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</p>
    </div>
    <!-- 版权结束 -->

    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#PHP" >
    <span class="tag-code">PHP</span>
  </a>

  <a href="/tags#Arch" >
    <span class="tag-code">Arch</span>
  </a>

  <a href="/tags#Web架构师" >
    <span class="tag-code">Web架构师</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2019/04/13/DevOps/2019-04-13/">
        <span class="nav-arrow">← </span>
        
          PHP架构师技能树
        
      </a>
    
    
  </div>

    <!-- NAV END -->

    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="vcomments"></div>
      <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#设计模式"><span class="toc-nav-text">设计模式</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#设计原则"><span class="toc-nav-text">设计原则</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-单一职责-原则"><span class="toc-nav-text">1.单一职责 原则</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-开-闭-原则-OCP"><span class="toc-nav-text">2.开/闭 原则(OCP)</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#3-里氏代换-原则-LSP"><span class="toc-nav-text">3.里氏代换 原则(LSP)</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#4-依赖倒转-原则"><span class="toc-nav-text">4.依赖倒转 原则</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#5-接口隔离-原则-ISP"><span class="toc-nav-text">5.接口隔离 原则(ISP)</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#6-迪米特-法则-LOD"><span class="toc-nav-text">6.迪米特 法则(LOD)</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#7-配置化"><span class="toc-nav-text">7. 配置化</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#8-合成复用-原则"><span class="toc-nav-text">8.合成复用 原则</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#php设计模式的基础"><span class="toc-nav-text">php设计模式的基础</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#命名空间"><span class="toc-nav-text">命名空间</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#定义命名空间"><span class="toc-nav-text">定义命名空间</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用命名空间"><span class="toc-nav-text">使用命名空间</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#use-别名"><span class="toc-nav-text">use 别名</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#匿名函数"><span class="toc-nav-text">匿名函数</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#定义"><span class="toc-nav-text">定义</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#匿名函数-变量传递"><span class="toc-nav-text">匿名函数 变量传递</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#绑定对象"><span class="toc-nav-text">绑定对象</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#回调函数"><span class="toc-nav-text">回调函数</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1-普通函数"><span class="toc-nav-text">1. 普通函数</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2-匿名函数"><span class="toc-nav-text">2. 匿名函数</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3-类的方法"><span class="toc-nav-text">3. 类的方法</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4-命名空间"><span class="toc-nav-text">4. 命名空间</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5-函数生成器"><span class="toc-nav-text">5. 函数生成器</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#6-内置函数"><span class="toc-nav-text">6. 内置函数</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#匿名类"><span class="toc-nav-text">匿名类</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#定义-1"><span class="toc-nav-text">定义</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#stdClass对象"><span class="toc-nav-text">stdClass对象</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#类的自动加载"><span class="toc-nav-text">类的自动加载</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#autoload"><span class="toc-nav-text">__autoload()</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#spl-autoload-register"><span class="toc-nav-text">spl_autoload_register()</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#PHP标准库-SPL"><span class="toc-nav-text">PHP标准库(SPL)</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#PHP常用的数据结构"><span class="toc-nav-text">PHP常用的数据结构</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-数组"><span class="toc-nav-text">1.数组</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-队列"><span class="toc-nav-text">2.队列</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-栈"><span class="toc-nav-text">3.栈</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-堆"><span class="toc-nav-text">4.堆</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#序列化-反序列化"><span class="toc-nav-text">序列化/反序列化</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#serialize-对象"><span class="toc-nav-text">serialize 对象</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#应用场景"><span class="toc-nav-text">应用场景</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#PSR规范"><span class="toc-nav-text">PSR规范</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#PSR-0-PSR-4"><span class="toc-nav-text">PSR-0 ~ PSR-4</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#PHP链式操作"><span class="toc-nav-text">PHP链式操作</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#魔术方法"><span class="toc-nav-text">魔术方法</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#get-set"><span class="toc-nav-text">get/set</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#call-callStatic"><span class="toc-nav-text">call/callStatic</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#toString-NaN"><span class="toc-nav-text">__toString</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#invoke"><span class="toc-nav-text">__invoke</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#浅拷贝与深拷贝"><span class="toc-nav-text">浅拷贝与深拷贝</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#普通变量"><span class="toc-nav-text">普通变量</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#对象"><span class="toc-nav-text">对象</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#函数参数"><span class="toc-nav-text">函数参数</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#PHP设计模式"><span class="toc-nav-text">PHP设计模式</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#工厂模式"><span class="toc-nav-text">工厂模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#单例模式"><span class="toc-nav-text">单例模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#注册机模式"><span class="toc-nav-text">注册机模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#适配器模式"><span class="toc-nav-text">适配器模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#策略模式"><span class="toc-nav-text">策略模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#数据对象映射模式"><span class="toc-nav-text">数据对象映射模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#观察者模式"><span class="toc-nav-text">观察者模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#原型模式"><span class="toc-nav-text">原型模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#装饰器模式"><span class="toc-nav-text">装饰器模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#迭代器模式"><span class="toc-nav-text">迭代器模式</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代理模式"><span class="toc-nav-text">代理模式</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#常用设计结构"><span class="toc-nav-text">常用设计结构</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#MVC-结构"><span class="toc-nav-text">MVC 结构</span></a></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://www.hi-arkin.com/2019/04/14/PHP/design_parttern/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error-img.svg')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error-img.svg') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

  
   
  

  })();
</script>
<!-- 评论 -->

<script>
    Valine && new Valine({
              el: '#vcomments',
              placeholder: '欢迎大家吐槽~ ',
              appId: 's00pjsgpQfTMhup6C0IC1e5w-gzGzoHsz',
              appKey: 'L1jipTeNE3kEt8GGtbJvGMvV',

    })
</script>


    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    
<footer class="app-footer">
  <div id="vcomments" style="max-width:800px"></div>
  <p class="copyright">
    <a href="http://tongji.baidu.com/web/welcome/ico?s=371952d9b83cd706a4702ef0c232e3de" target="_blank">...</a>
    &copy; 2019 |  Powered by 阿金 
   <br/> <a href="http://www.miitbeian.gov.cn" rel="nofollow" target="_blank"> 京ICP备18064786号-1 </a>
  </p>
</footer>
<script src="/js/search.js"></script> 

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.staticfile.org/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.staticfile.org/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>



   <script type="text/javascript">   
     var search_path = "search.xml";
   if (search_path.length == 0) {
    search_path = "search.xml";
   }
   var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>



<!-- Baidu Tongji -->

<script>
    var _baId = '371952d9b83cd706a4702ef0c232e3de';
    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>


<script src="/js/script.js"></script>

  </body>
</html>